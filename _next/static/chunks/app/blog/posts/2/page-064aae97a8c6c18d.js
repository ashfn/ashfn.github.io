(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{87764:(e,t,n)=>{Promise.resolve().then(n.bind(n,70669))},70669:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var s=n(95155);let o="dnsimg - storing images in txt records",i="I was intrigued by the idea of storing images in DNS records, and I wanted to test out how effectively images could be stored in DNS records. I've always been interested in TXT records because they seem to be a useful way of storing arbitrary data, and in this blog post I'll discuss how I went from an idea to developing the project into almost a protocol sort of method for storing an image on a domain name.";var r=n(48173),a=n.n(r),d=n(76559),l=n(12115),c=n(15266),u=n(5565),h=n(3104);function m(){let e="".concat(o," | Asher Falcon");return(0,l.useEffect)(()=>{document.title=e;let t=document.querySelector('meta[name="description"]');t&&t.setAttribute("content",i);let n=document.querySelector('meta[property="og:title"]');n||((n=document.createElement("meta")).setAttribute("property","og:title"),document.head.appendChild(n)),n.setAttribute("content",o);let s=document.querySelector('meta[property="og:description"]');s||((s=document.createElement("meta")).setAttribute("property","og:description"),document.head.appendChild(s)),s.setAttribute("content",i)},[e]),(0,s.jsx)("div",{className:"h-screen bg-ashwhite",children:(0,s.jsx)(d.PageTransition,{children:(0,s.jsxs)("div",{className:"pb-[20px]",children:[(0,s.jsxs)("div",{style:{paddingTop:"50px"},className:"relative flex justify-center items-center h-[50px]",children:[(0,s.jsx)("div",{className:"absolute left-0 flex items-center h-full ml-6",children:(0,s.jsx)(c.default,{defaultPath:"/blog"})}),(0,s.jsx)("span",{className:"text-sm sm:text-base md:text-xl lg:text-2xl truncate max-w-[80%]",children:o})]}),(0,s.jsx)("div",{style:{paddingTop:"30px"},className:"flex justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("div",{children:(0,s.jsx)("p",{children:i})})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"So, an image inside DNS? How can it be done? Well the most obvious way and the method I tried here was storing the data inside TXT records. Firstly, we need to find a way to store the image inside the dns records. At first the method I tried was simply getting the hex characters of the data. We get this using the command below: "})}),(0,s.jsx)(h.A,{language:"bash",code:"xxd -p output.jpg > output.txt"}),(0,s.jsxs)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:[(0,s.jsx)("p",{children:"This will not be as efficient as storing the data in base64 format, as this will use 2x the space where base64 would only use 1.33x the file size, however for testing I believe it is fine to use for now."}),(0,s.jsx)("p",{children:"The next hurdle is as you can see below, when I tried to just add all the hex data in one txt record, cloudflare shows us an errror:"})]}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)(u.default,{src:"/img1.png",alt:"output",width:600,height:400})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"So, we need to split our hex data into 2048 character chunks. A simple python script can be written to do this and found below:"})}),(0,s.jsx)(h.A,{language:"python",code:'image = open("output.txt", "r").read()\nimage = image.replace("\\n", "")\nchunks = []\n\ntotal = int(len(image)/2048)+1\n\nfor i in range(total):\n    chunk = image[i*2048:(i+1)*2048]\n    print(f"Chunk #{i+1}, size: {len(chunk)}")\n    chunks.append(chunk)\n\ndomain = "asherfalcon.com"\n\nwith open(f"{domain}.txt", "a") as dns:\n    for chunkIndex in range(len(chunks)):\n        dns.write(f"dnsimg-{chunkIndex+1}.{domain}.	60	IN	TXT	"{chunks[chunkIndex]}"\n")\n    dns.write(f"dnsimg-count.{domain}.	60	IN	TXT	"{len(chunks)}"\n")'}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"This will create a txt record for each chunk of the image, and a 'dnsimg-count' record for the total number of chunks. The count is neccesary so that when we want to load the iamge, we know how many chunks exist and how many we need to request. "})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"We can then upload the dns file to cloudflare and import it, which will create all the records for us. After a few minutes using the dig command we can see that the chunks have been stored. Cloudflare splits them up into additional chunks per record but that is not an issue as we can just concatenate them."})}),(0,s.jsxs)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:[(0,s.jsx)(u.default,{src:"/img2.png",alt:"output",width:600,height:400}),(0,s.jsx)(u.default,{className:"mt-4",src:"/img3.png",alt:"output",width:600,height:400})]}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"Now we know that our data is out there, lets try rebuild the image from the dns records. We can write another simple python script to fetch them using dig asynchronously and then concatenate them into a single file, in jpg format. See the script below:"})}),(0,s.jsx)(h.A,{language:"python",code:'import subprocess\nimport threading\nimport sys\n\nclass bcolors:\n    HEADER = \'\\\\033[95m\'\n    OKBLUE = \'\\\\033[94m\'\n    OKCYAN = \'\\\\033[96m\'\n    OKGREEN = \'\\\\033[92m\'\n    WARNING = \'\\\\033[93m\'\n    FAIL = \'\\\\033[91m\'\n    ENDC = \'\\\\033[0m\'\n    BOLD = \'\\\\033[1m\'\n    UNDERLINE = \'\\\\033[4m\'\n\n# Replace with your domain\ndomain = "containerback.com"\n\n# Run the dig command\nresult = subprocess.run(\n    ["dig", "@8.8.8.8", "+short", f"dnsimg-count.{domain}", "TXT"],\n    stdout=subprocess.PIPE,\n    stderr=subprocess.PIPE,\n    text=True\n)\n\nchunks = []\n\ndef printStatus():\n    # "\\\\033[F"+\n    msg = bcolors.OKBLUE+"["\n    for i in chunks:\n        if(i==""):\n            msg+=bcolors.FAIL+"#"\n        else:\n            msg+=bcolors.OKGREEN+"#"\n    msg+=bcolors.OKBLUE+"]"\n    print(msg)\n\n\n\ndef getChunk(chunkIndex):\n    chunk = subprocess.run(\n        ["dig", "+short", f"dnsimg-{chunkIndex+1}.{domain}", "TXT"],\n        stdout=subprocess.PIPE,\n        stderr=subprocess.PIPE,\n        text=True\n    )\n    if(chunk.stdout!=""):\n        chunkData = chunk.stdout.replace(" ","").replace("\\\\\\"","").replace("\\\\\\n","")\n        chunks[chunkIndex] = chunkData\n    else:\n        print(f"Err {chunkIndex} {chunk.stderr} &apos;{chunk.stdout}&apos;")\n        # printStatus()\n        # print(f"Added chunk #{chunkIndex+1} ({len(chunkData)} chars)")\n\nif(result.stdout == ""):\n    print("No dnsimg found")\nelse:\n    size = int(result.stdout[1:-2])\n    print(f"Found dnsimg with {size} chunks")\n    \n    chunks = [""]*size\n\n    threads = []\n\n    for chunkIndex in range(size):\n        threads.append(threading.Thread(target=getChunk, args=(chunkIndex,)))\n\n    for t in threads:\n        t.start()\n\n    for t in threads:\n        t.join()\n        printStatus()\n\n    printStatus()\n    with open("dnsimg.jpg", "wb") as output:\n        output.write(bytes.fromhex("".join(chunks)))'}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"When I first tried this I don't think the records had properly propagated, so I had to wait a few minutes before I could see the image. Look below to see the (slightly) corrupted image created when a few records were missing:"})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)(u.default,{src:"/img4.jpg",alt:"output",width:600,height:400})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"After waiting another 10 or so minutes, we can run it again and get the full image through! The image is stored in 21 chunks of 2048 characters, and is not a terribly high resolution but it serves as a good first proof of concept:"})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)(u.default,{src:"/img5.png",alt:"output",width:600,height:400})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("p",{children:"Next I wanted to try some larger images, which mostly worked but I found an upper bound when I tried a (over 1MB) image. Not sure if this is a cloudflare limit or a wider rule but heres the error I got:"})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)(u.default,{src:"/img6.png",alt:"output",width:600,height:200})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsxs)("p",{children:["So, finally I created a lovely web tool you can try out ",(0,s.jsx)(a(),{className:"text-blue-500",href:"https://dnsimg.asherfalcon.com",target:"_blank",children:"here"})," which allows you to type a domain and load its image. I created images on the domains 'asherfalcon.com' and 'containerback.com' but you should try add images to your own domains! You can use a domain or any subdomain and use the scripts in the repository ",(0,s.jsx)(a(),{className:"text-blue-500",href:"https://git.asherfalcon.com/asher/image_over_dns",target:"_blank",children:"here"})," to create your own image. If you want to see a video of the web tool in action see below:"]})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/5BO38soTjjA?start=64",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),(0,s.jsx)("div",{style:{paddingTop:"30px",paddingBottom:"30px"},className:"flex flex-col justify-center items-center md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsxs)("p",{children:["I hope you enjoyed this blog post! If you have any questions or comments, please feel free to reach out to me ",(0,s.jsx)(a(),{href:"/contact",className:"text-blue-500",children:"here"})]})})]})})})}},15266:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});var s=n(95155),o=n(34367),i=n(76046),r=n(12115);function a(e){let{defaultPath:t="/",className:n="",forceDefault:a=!1}=e,d=(0,i.useRouter)(),[l,c]=(0,r.useState)(null);(0,r.useEffect)(()=>{c(sessionStorage.getItem("previousUrl")),sessionStorage.setItem("previousUrl",window.location.href);let e=()=>{sessionStorage.removeItem("previousUrl"),sessionStorage.removeItem("backHistory")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let u=(e,t)=>{let n=[...JSON.parse(sessionStorage.getItem("backHistory")||"[]"),{from:e,to:t,timestamp:Date.now()}].filter(e=>Date.now()-e.timestamp<1e4);if(n.length>=4){let e=n.slice(-4);if(4===e.length){let[t,n,s,o]=e;if(t.from===s.from&&t.to===s.to&&n.from===o.from&&n.to===o.to&&t.from===n.to&&n.from===t.to)return!0}}return n.filter(n=>n.from===e&&n.to===t).length>=2||(sessionStorage.setItem("backHistory",JSON.stringify(n)),!1)};return(0,s.jsx)("button",{onClick:()=>{if(a){d.push(t);return}let e=window.location.href,n=window.location.origin;if(l)try{if(new URL(l).origin!==n){d.push(t);return}if(u(e,l)){sessionStorage.removeItem("backHistory"),d.push(t);return}}catch(e){d.push(t);return}if(!l&&document.referrer)try{if(new URL(document.referrer).origin!==n){d.push(t);return}}catch(e){d.push(t);return}if(!l&&!document.referrer){d.push(t);return}d.back()},className:"flex items-center justify-center p-0 m-0 bg-transparent border-0 cursor-pointer ".concat(n),"aria-label":"Go back",children:(0,s.jsx)(o.K9R,{size:30})})}},76559:(e,t,n)=>{"use strict";n.d(t,{PageTransition:()=>r});var s=n(95155),o=n(18606);let i={hidden:{opacity:0},enter:{opacity:1},exit:{opacity:0}},r=e=>{let{children:t}=e;return(0,s.jsx)(o.P.div,{variants:i,initial:"hidden",animate:"enter",exit:"exit",transition:{type:"easeInOut",duration:.5},children:t})}},3104:(e,t,n)=>{"use strict";n.d(t,{A:()=>d,q:()=>l});var s=n(95155),o=n(12115),i=n(98867),r=n(23920),a=n(49216);function d(e){let{code:t,language:n="typescript"}=e,[d,l]=(0,o.useState)(!1),c=async()=>{try{await navigator.clipboard.writeText(t),l(!0),setTimeout(()=>l(!1),1500)}catch(e){console.error("Failed to copy:",e)}};return(0,s.jsx)("div",{className:"md:w-[70%] xl:w-[50%] w-[85%] mx-auto",children:(0,s.jsxs)("div",{className:"relative text-white",children:[(0,s.jsx)("div",{style:{position:"absolute",right:"10px",top:"10px"},children:(0,s.jsx)("button",{onClick:c,className:"p-2 rounded",children:d?(0,s.jsx)(i.A,{size:16,color:"#000000"}):(0,s.jsx)(r.A,{size:16,color:"#000000"})})}),(0,s.jsx)("center",{children:(0,s.jsx)(a.A,{language:n,customStyle:{backgroundColor:"transparent",border:"2px solid #000000",borderRadius:"8px",padding:"1rem",width:"100%",textAlign:"left"},children:t})})]})})}function l(e){let{code:t,language:n="typescript"}=e;return(0,s.jsx)(a.A,{language:n,PreTag:"span",CodeTag:"code",customStyle:{display:"inline",backgroundColor:"transparent",padding:0,margin:0,border:"none"},codeTagProps:{style:{display:"inline",padding:0,margin:0}},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[206,606,173,126,565,441,517,358],()=>t(87764)),_N_E=e.O()}]);